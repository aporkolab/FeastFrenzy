<!-- Loading State -->
@if (isLoading) {
  <div class="row mb-4">
    <div class="col-md-6">
      <app-card-skeleton [showImage]="false" [textLines]="5" [showAction]="true"></app-card-skeleton>
    </div>
  </div>
  <app-table-skeleton [rows]="3" [columns]="3"></app-table-skeleton>
}

<!-- Error State -->
@if (error && !isLoading) {
  <app-error-state 
    [message]="error"
    (retry)="loadPurchase()"
    actionText="Go Back"
    (action)="goBack()"
  ></app-error-state>
}

<!-- Purchase Detail -->
@if (purchase && !isLoading && !error) {
  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h4 class="mb-0">Purchase Details</h4>
      <div class="d-flex gap-2 align-items-center">
        <span 
          class="badge"
          [class.bg-success]="purchase.closed"
          [class.bg-warning]="!purchase.closed"
        >
          {{ purchase.closed ? 'Closed' : 'Open' }}
        </span>
        <span class="badge bg-secondary">#{{ purchase.id }}</span>
      </div>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label text-muted">Date</label>
          <p class="fs-5 mb-0">{{ purchase.date | date:'mediumDate' }}</p>
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label text-muted">Employee ID</label>
          <p class="fs-5 mb-0">{{ purchase.employeeId }}</p>
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label text-muted">Total</label>
          <p class="fs-5 mb-0 text-success fw-bold">{{ purchase.total | currency }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Purchase Items -->
  <div class="card">
    <div class="card-header">
      <h5 class="mb-0">Purchase Items</h5>
    </div>
    <div class="card-body p-0">
      @if (purchase.purchaseItems && purchase.purchaseItems.length > 0) {
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th>Product ID</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th class="text-end">Subtotal</th>
              </tr>
            </thead>
            <tbody>
              @for (item of purchase.purchaseItems; track item.productId) {
                <tr>
                  <td>{{ item.productId }}</td>
                  <td>{{ item.quantity }}</td>
                  <td>{{ item.price | currency }}</td>
                  <td class="text-end">{{ item.price * item.quantity | currency }}</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      } @else {
        <div class="text-center text-muted p-4">
          No items in this purchase.
        </div>
      }
    </div>
  </div>

  <!-- Actions -->
  <div class="mt-4">
    <button class="btn btn-outline-secondary" (click)="goBack()">
      ‚Üê Go Back
    </button>
  </div>
}