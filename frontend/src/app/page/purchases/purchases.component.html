<div class="purchases-container">
  <!-- Loading State -->
  @if (isLoading) {
    <app-table-skeleton [rows]="8" [columns]="5"></app-table-skeleton>
  }

  <!-- Error State -->
  @if (error && !isLoading) {
    <app-error-state 
      [message]="error"
      (retry)="loadPurchases()"
    ></app-error-state>
  }

  <!-- Empty State -->
  @if (!isLoading && !error && purchases.length === 0) {
    <app-error-state
      type="empty"
      title="No purchases found"
      message="Create your first purchase using the form below."
      [showRetry]="false"
    ></app-error-state>
  }

  <!-- Data Table -->
  @if (!isLoading && !error && purchases.length > 0) {
    <div class="table-responsive">
      <table class="table table-hover">
        <thead class="table-light">
          <tr>
            <th>Employee ID</th>
            <th>Total</th>
            <th>Date</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (purchase of purchases; track purchase.id) {
            <tr>
              <td>{{ purchase.employeeId }}</td>
              <td>{{ purchase.total | currency }}</td>
              <td>{{ purchase.date | date:'short' }}</td>
              <td>
                <span 
                  class="badge"
                  [class.bg-success]="purchase.closed"
                  [class.bg-warning]="!purchase.closed"
                >
                  {{ purchase.closed ? 'Closed' : 'Open' }}
                </span>
              </td>
              <td class="table-actions">
                <button (click)="editPurchase(purchase)" class="btn btn-sm btn-outline-secondary">Edit</button>
                <button (click)="deletePurchase(purchase)" class="btn btn-sm btn-outline-danger">Delete</button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- Purchase Form -->
  <div class="card mt-4">
    <div class="card-header">
      <h5 class="mb-0">{{ editingPurchase ? 'Edit Purchase' : 'Add Purchase' }}</h5>
    </div>
    <div class="card-body">
      <form (ngSubmit)="addPurchase()" class="row g-3">
        <div class="col-md-3">
          <label class="form-label">Employee ID</label>
          <input 
            type="number" 
            class="form-control"
            [(ngModel)]="formData.employeeId" 
            name="employeeId" 
            required
          >
        </div>
        <div class="col-md-3">
          <label class="form-label">Date</label>
          <input 
            type="date" 
            class="form-control"
            [(ngModel)]="formData.date" 
            name="date" 
            required
          >
        </div>
        <div class="col-md-3">
          <label class="form-label">Total</label>
          <input 
            type="number" 
            class="form-control"
            [(ngModel)]="formData.total" 
            name="total" 
            step="0.01" 
            min="0"
          >
        </div>
        <div class="col-md-3">
          <label class="form-label d-block">&nbsp;</label>
          <div class="form-check">
            <input 
              type="checkbox" 
              class="form-check-input"
              [(ngModel)]="formData.closed" 
              name="closed"
              id="closedCheck"
            >
            <label class="form-check-label" for="closedCheck">Closed</label>
          </div>
        </div>
        <div class="col-12">
          <button type="submit" class="btn btn-primary">
            {{ editingPurchase ? 'Update' : 'Add' }} Purchase
          </button>
          @if (editingPurchase) {
            <button type="button" class="btn btn-outline-secondary ms-2" (click)="cancelEdit()">
              Cancel
            </button>
          }
        </div>
      </form>
    </div>
  </div>
</div>